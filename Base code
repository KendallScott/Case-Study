library(dplyr)
library(tidyr)
#reading in the csvs
brewery = read.csv(file.choose(),header = TRUE)
beer = read.csv(file.choose(),header = TRUE)

#renaming columns for the join to the beer dataset
brewery=rename(brewery, Brewery_id=Brew_ID, Brewery=Name)

#join between brewery and beer data
beer_brewery = merge(x=brewery,y=beer,by="Brewery_id")

#filtering of NAs for ABV and IBU-- rows drop from 2410 down to 1405 for this filtering
#only use this filtered dataset for the questions related to ABV/IBU
beer_brewery <- beer_brewery %>% filter_at(vars(ABV,IBU),all_vars(!is.na(.)))


```{r}
#question 1 (and possibly part of 9)
#load libraries
library(ggplot2)
library(maps)
library(tidyverse)
library(ggthemes)
#load counties table
cnty <- read.csv("cty-cnty.csv")
colnames(cnty)[3] <- "region"

#data wrangle
brewery$State <- trimws(brewery$State, which = c("left"))
cnty <- cnty %>% select("City", "State","County","region")#select columns
cnty <- cnty[!duplicated(cnty),]


#left join brew and cnty
brewcomb <- merge(brewery, select(cnty, c("City", "State", "County","region")), by=c("City","State"))
brewcomb <- brewcomb %>% distinct(Brew_ID, .keep_all = TRUE)#missing change from MA to MI

#1 table wtih state count, map with state count and map with county count
#state and county tables
us_states <- map_data("state")
us_counties <- map_data("county")

#state brewery count
brew_state <- brewcomb %>% mutate(region=tolower(region)) %>%
  group_by(region) %>% count(region)
brew_state %>% arrange(desc(n))
#state gradient map
us_states %>% left_join(brew_state,by=("region")) %>% 
  ggplot(aes(x=long,y=lat,group=group,fill=n))+
  geom_polygon(color = "gray90", size=.1)+
  coord_map(projection = "albers", lat0=45, lat1=55)+
  scale_fill_viridis_c()+
  theme(axis.line = element_blank(),
        axis.text = element_blank(),
        axis.ticks = element_blank(),
        panel.background = element_blank(),
        axis.title = element_blank())+
  labs(fill="Brewery\nCount")+
  ggtitle("Breweries by State\nContinental US")
  
#county brewery count
brew_county <- brewcomb %>% mutate(subregion=tolower(County)) %>% 
  group_by(subregion) %>% count(subregion)
#county gradient map
us_counties %>% left_join(brew_county,by="subregion") %>%
  ggplot()+
  geom_polygon(aes(x=long,y=lat,group=group,fill=n),color = "gray90",size=.1)+
  coord_map(projection = "albers",lat0=45,lat1=55)+
  scale_fill_viridis_c()+
  theme(axis.line = element_blank(),
        axis.text = element_blank(),
        axis.ticks = element_blank(),
        panel.background = element_blank(),
        axis.title = element_blank())+
  labs(fill="Brewery\nCount")+
  ggtitle("Breweries by County\nContinental US")+
  geom_polygon(data = us_states,aes(x=long,y=lat,group=group), color = "white",size=.15,fill="transparent")
```
```{r}
#6 comment on the summary statistics and distribution of the ABV variable
beer_brewery %>% ggplot(aes(x=Beer_ID,y=ABV))+geom_point()
beer_brewery %>% ggplot(aes(x=ABV))+geom_density()

beer_brewery %>% select(ABV) %>%
  summarise(min=min(ABV),
            "25%"=quantile(ABV,.25),
            median=median(ABV),
            "75%"=quantile(ABV,.75),
            max=max(ABV),mean=mean(ABV))
```
#bar graph of median alcohol content by State
#Question 4
bb<-beer_brewery %>% filter(!is.na(ABV)) %>% group_by(State) %>% summarize(meanABV = mean(ABV), meanIBU=round(mean(IBU),0), count = n()) %>% ggplot(aes(x = reorder(State, -meanABV), y = meanABV, fill=meanIBU)) + geom_col(width=1)+ 
  xlab('State') + ylab('Average ABV')+ggtitle("Average IBU/ABV by State") +
  labs(fill="ABV")+ theme(axis.text = element_text(size = 6))+ scale_fill_gradient(low='#bee0ec',high='#1a6985', 
                                                                                      name='Average IBU')
bb + scale_y_continuous(labels = scales::percent)+ coord_flip()

